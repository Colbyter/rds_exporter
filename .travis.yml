dist: bionic
language: go

services:
  - docker

go:
  - 1.15.x
  - 1.14.x
  - tip

matrix:
  fast_finish: true
  allow_failures:
    - go: tip

# skip non-trunk PMM-XXXX branch builds, but still build pull requests
branches:
  except:
    - /^PMM\-\d{4}/

cache:
  directories:
    - /home/travis/.cache/go-build
    # - /home/travis/gopath/pkg

before_cache:
  - go clean -testcache
  # - go clean -cache

go_import_path: github.com/percona/rds_exporter

env:
  global:
    # AWS - PMM Autotest account.
    # Travis secrets are not exposed to pull requests from forks: https://docs.travis-ci.com/user/pull-requests#pull-requests-and-security-restrictions
    - AWS_ACCESS_KEY=AKIAZPBRO3QWGCO72MJZ
    - secure: "tMvScZPnZZBY/RUNt2Xg9wer7sJPPpHkLjTM79qzQ8RvJ1R/SL2SXwILo9L1uoJmJcSvDTnJH9UMV1RLnxHdENsNxkJrykMjQDiECR45aV5XaWbrNYz74oIn4xgoWQYd/vz9H5Z6C2foy/lbd+B//S4hQIQ3hKPd9J2lM8bG3rjt8jiQOfyfGU1NRrKUvt3Bb8Tj5R+btDHPWl+81DLRcQmqjv3dwNA/IJB81bmm6hYrg27SIKyruewjIIi6KVv3bOw6U/ms+7iGSQwp5Rr+5j4LUHkRFvNlXydmFJZcu1RfszUMDjS2akuYuItGYiOrS2Nbdh/51NEVXpH101zvDbAV7RAreGYCCCyAXKna+NrP8RTXSouHKp2s/6H8rDIKb7ASovSqZkSo+ZJmHUGwE/UzdWExohrNQBej/VkWYVwszjLH3K9Vp0zlCd0bs4JezWPqHJYvLa1qIzoEQfsfexUKQeuZM1HUvSaSxXqdWGWQ2sxxtRwdMxJnsKYPOSjNh6zddDmIyBZtDGlezxftRNMDNhK8LHvO1qbyL4E+RdRToGYrYiPVkuACFewhyM/Yvqeo68IFUPcK4l+UcoQYt9p7P/Y15//GRI4RPZKr7CLoxh4dnPoTUZSf/QXTN/05ymiP6cpUWPMDA4m4Zb3u3D2SLVMFRa20OFYqqHQWI2A="
    # REVIEWDOG_GITHUB_API_TOKEN
    - secure: "2OwS09wZF45Is+/fGsXrPXjzQ3pd1DgX6FC/bCoclK81L9Ad8ghGcNPMj4fScyaLHur6kEKPkurZgKoIhNzbLPArg1rna/BqJFIJFtmHIuTKRbyDvv2rU0hqvIaMWdHHDHXuFhpHtyiczzids/JzfurzHyoZZpl6mZ7MrFU2qoR9MH/pnYFdXAf1D6Af0qHWC6SC/jCln1knhP1eYnVYvA4ImYa+uLXcPC6pPO/LuRzrRw79BamMfH4RmCI27abUVp/Vwim36Fxxt9fiXkCImPnK4PALqTpGhcBdgp/fHmqnBHSlfVKFREmwpmtQ4EGlMau1WgSUlqH89GRQ5gvXv/J8wwQRLZQRUalM34v9t/XjbWbTg+5LwJNbtI229RsY7XS0Ty0UnLSmb4GeiUZ1mf1sKgnTAZM/bz6np3hCk8d0dJlaJMO+9HL/4O2wTNFmRLsYbWAwhrS3Jhk6eQ9XnS+OPod4qVF1LjvCeM9WPUG1p7SyTrtzaTi0z/elaQ60GzZ6VCto3hXHTqhtEuZFIMxqxgUxDIAqppudE7jzZaU6DNscEyjmKnh+cKsTzq1bAdBA2wK0cnR8aemZJKZqEcyGwZPs185PyVKhZ53s7362hKD4th4td2V4rNqJ/R+qGE57KRKUBmELWPPCSh7YvdaixTaT1QM9rzZjtWhUBMg="

install:
  # install reviewdog and golangci-lint
  - curl https://raw.githubusercontent.com/reviewdog/reviewdog/master/install.sh| sh -s
  - curl https://raw.githubusercontent.com/golangci/golangci-lint/master/install.sh | sh -s latest

script:
  - make travis
